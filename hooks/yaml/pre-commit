#!/usr/bin/env sh

set -e

command -v yamlfmt >/dev/null || (
  echo "yamlfmt is not installed"
  exit 1
)
command -v yamllint >/dev/null || (
  echo "yamllint is not installed"
  exit 1
)

FILES=$(git diff --cached --name-only --diff-filter=ACMR "*.yaml" "*.yml")

[ -z "$FILES" ] && exit 0

echo "=> Check code format..."
(
  set -x
  # shellcheck disable=SC2086
  yamlfmt -dry -lint $FILES
)

echo "=> Check code lint..."
(
  set -x
  # shellcheck disable=SC2086
  yamllint $FILES
)
