#!/usr/bin/env sh
#shellcheck disable=SC2086

set -e

# shellcheck disable=SC1091
. "$(dirname "$0")"/../_utils.sh

ensure_command "yamlfmt"
ensure_command "yamllint"

FILES=$(get_modified_files "*.yaml" "*.yml")

YAMLFMT_FLAGS="
-dry
-lint
-formatter
indent=2,include_document_start=true,line_ending=lf,retain_line_breaks_single=true,scan_folded_as_literal=true,trim_trailing_whitespace=true,eof_newline=true
"
YAMLLINT_FLAGS="
--no-warnings
-d
default
"

# FORMAT
if [ -n "$FILES" ]; then
  (
    IFS="
"
    run_and_print yamlfmt $YAMLFMT_FLAGS $FILES
  )
fi

# LINT
if [ -n "$FILES" ]; then
  (
    IFS="
"
    run_and_print yamllint $YAMLLINT_FLAGS $FILES
  )
fi
